---
phase: 02-scraping-pipeline-4-hours
plan: 04
type: execute
wave: 3
depends_on:
  - "02-03"
files_modified:
  - src/app/(dashboard)/projects/page.tsx
  - src/app/(dashboard)/projects/[id]/page.tsx
  - src/components/scraper/ScrapeInput.tsx
  - src/components/scraper/ScrapePreviewCard.tsx
  - src/components/scraper/VideoCard.tsx
  - src/components/scraper/VideoGrid.tsx
autonomous: true
requirements:
  - R2.1
  - R2.2
  - R2.7
  - R2.9

must_haves:
  truths:
    - "ScrapeInput auto-detects video URL vs channel URL and shows appropriate UI flow"
    - "ScrapePreviewCard shows thumbnail, title, duration, channel name, and Confirm / Cancel buttons before any download starts"
    - "VideoGrid renders responsive card grid of scraped videos using re_videos data from Supabase"
    - "VideoCard shows thumbnail, title, duration badge, pipeline status badge, channel name subtitle — all from re_videos row"
    - "Projects page lists all projects with create-project button"
    - "Project detail page [id] shows ScrapeInput + VideoGrid for that project"
    - "All colors use --re-* CSS variables — no hardcoded hex"
    - "Glassmorphism CSS-only on cards: backdrop-filter, subtle border, box-shadow — zero extra DOM elements"
  artifacts:
    - path: "src/components/scraper/ScrapeInput.tsx"
      provides: "Smart URL input with auto-detect, multi-line paste support, duplicate warning"
      exports: ["ScrapeInput"]
    - path: "src/components/scraper/ScrapePreviewCard.tsx"
      provides: "Preview card shown before confirming scrape"
      exports: ["ScrapePreviewCard"]
    - path: "src/components/scraper/VideoCard.tsx"
      provides: "Single video card with thumbnail, badges, metadata"
      exports: ["VideoCard"]
    - path: "src/components/scraper/VideoGrid.tsx"
      provides: "Grid of VideoCards with loading skeleton state"
      exports: ["VideoGrid"]
    - path: "src/app/(dashboard)/projects/page.tsx"
      provides: "Projects list page with create button"
    - path: "src/app/(dashboard)/projects/[id]/page.tsx"
      provides: "Project detail page with ScrapeInput and VideoGrid"
  key_links:
    - from: "src/components/scraper/ScrapeInput.tsx"
      to: "src/app/api/remix-engine/scrape/preview/route.ts"
      via: "POST /api/remix-engine/scrape/preview to fetch metadata before confirming"
      pattern: "scrape/preview"
    - from: "src/app/(dashboard)/projects/[id]/page.tsx"
      to: "src/components/scraper/ScrapeInput.tsx"
      via: "ScrapeInput receives projectId prop"
      pattern: "ScrapeInput"
    - from: "src/app/(dashboard)/projects/[id]/page.tsx"
      to: "src/components/scraper/VideoGrid.tsx"
      via: "VideoGrid receives videos array from server-fetched re_videos"
      pattern: "VideoGrid"
---

<objective>
Build the Projects page UI and project detail page with the scrape URL input and video library. This plan covers only the static/initial-load UI — the live progress updates are wired in Plan 07. After this plan, users can browse their project's scraped videos, paste a URL, see a preview, and confirm a scrape.

Purpose: Plan 03 built the backend. This plan builds the frontend entry point. The ScrapeInput → Preview Card → Confirm flow matches the locked UX decisions from CONTEXT.md.
Output: Projects list, project detail page, ScrapeInput with preview card, VideoCard and VideoGrid components.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/02-scraping-pipeline-4-hours/02-CONTEXT.md
@design-system/MASTER.md

LOCKED DECISIONS (from CONTEXT.md — implement EXACTLY):
- Preview before scrape: paste URL → fetch metadata → show preview card → user confirms before downloading
- Single smart input: auto-detects video URL vs channel URL
- All YouTube URL formats accepted (full URLs, short URLs, mobile, shorts, playlists)
- Multi-line paste: user pastes multiple video URLs, one per line — same queue experience as channel batch
- Duplicate detection: warn "This video already exists in this project. Scrape again?"
- Card grid layout: thumbnail-forward responsive grid
- VideoCard shows: thumbnail, title, duration badge, pipeline status badge, channel name as subtitle
- Product name: EpicVideo

VISUAL DESIGN (locked):
- Glassmorphism CSS-only: backdrop-filter blur(12px), bg-white/5 or bg-[--re-bg-secondary]/80, border-white/10, box-shadow with glow — ZERO extra DOM elements
- No hardcoded hex colors — all --re-* CSS variables
- Glow on interactive elements: box-shadow with --re-accent-primary at low opacity

CLAUDE'S DISCRETION:
- Loading skeleton design and animation
- Exact glassmorphism intensity values
- Card hover animations
- Responsive breakpoints
- Error state visual treatment

IMPORTANT: These are 'use client' components. Projects list page is a server component that fetches from Supabase. Project detail page [id] is a server component that passes data to client components.
</context>

<tasks>

<task type="auto">
  <name>Task 1: ScrapeInput and ScrapePreviewCard components</name>
  <files>
    src/components/scraper/ScrapeInput.tsx
    src/components/scraper/ScrapePreviewCard.tsx
  </files>
  <action>
**src/components/scraper/ScrapeInput.tsx** — 'use client'. Smart URL input that handles the preview → confirm scrape flow.

Props:
```typescript
interface ScrapeInputProps {
  projectId: string;
  onScrapeStarted?: (jobId: string, videoId: string) => void;
  onBatchScrapeStarted?: (results: Array<{ jobId: string; videoId: string; youtubeId: string }>) => void;
}
```

State:
- `inputValue: string` — raw textarea content
- `isLoading: boolean` — fetching preview
- `preview: PreviewData | null` — data from /scrape/preview
- `existingVideo: { videoId: string } | null` — if duplicate detected
- `error: string | null` — validation error message
- `isScraping: boolean` — POST to /api/remix-engine/scrape in progress

Type PreviewData (local, not exported):
```typescript
interface PreviewData {
  youtubeId: string;
  title: string;
  thumbnailUrl: string;
  durationSeconds: number;
  channelName: string;
  viewCount: number;
  youtubeUrl: string; // original URL
}
```

**Multi-URL detection:** Check if inputValue contains newlines or multiple URLs. If trimmed input has no newlines → single URL flow. If has newlines → batch flow (split by '\n', filter empty lines).

**handleSubmit(e):**
1. e.preventDefault()
2. const urls = inputValue.split('\n').map(u => u.trim()).filter(Boolean)
3. If urls.length > 1: go to batch flow (see below)
4. Single URL flow:
   - setIsLoading(true)
   - POST /api/remix-engine/scrape/preview with { youtubeUrl: urls[0], projectId }
   - On success: if response.existing → setExistingVideo({ videoId: response.videoId }); else setPreview(response.preview)
   - On error (e.g., TOO_LONG): setError(response.message)
   - setIsLoading(false)
5. Batch flow (urls.length > 1):
   - If urls.length > 10: setError('Maximum 10 URLs at once'); return
   - POST /api/remix-engine/scrape/batch with { youtubeUrls: urls, projectId }
   - On success: onBatchScrapeStarted?.(response.enqueued)
   - On error: setError(message)

**handleConfirmScrape():**
- POST /api/remix-engine/scrape with { youtubeUrl: preview.youtubeUrl, projectId }
- On success: onScrapeStarted?.(response.jobId, response.videoId); setPreview(null); setInputValue('')
- On error: setError(message)

**handleConfirmRescrape():** Same as handleConfirmScrape but for the duplicate case.

**UI structure:**
```jsx
<div className="w-full">
  {/* Input area */}
  {!preview && !existingVideo && (
    <form onSubmit={handleSubmit}>
      <div className="relative" style={{ /* glass card */ }}>
        <textarea
          value={inputValue}
          onChange={e => setInputValue(e.target.value)}
          placeholder="Paste YouTube URL(s) — one per line for batch scraping"
          rows={inputValue.includes('\n') ? 4 : 1}
          className="w-full bg-transparent resize-none outline-none text-[--re-text-primary] placeholder:text-[--re-text-muted] p-4 pr-24"
        />
        <Button type="submit" disabled={isLoading || !inputValue.trim()} className="absolute right-3 top-3">
          {isLoading ? <Loader2 className="animate-spin" /> : <ArrowRight />}
        </Button>
      </div>
      {error && <p className="text-[--re-destructive] text-sm mt-2">{error}</p>}
    </form>
  )}

  {/* Preview card */}
  {preview && (
    <ScrapePreviewCard
      preview={preview}
      onConfirm={handleConfirmScrape}
      onCancel={() => { setPreview(null); setInputValue(''); }}
      isLoading={isScraping}
    />
  )}

  {/* Duplicate warning */}
  {existingVideo && (
    <div className="...glass card..." >
      <p className="text-[--re-warning]">This video already exists in this project. Scrape again?</p>
      <div className="flex gap-3 mt-4">
        <Button onClick={handleConfirmRescrape} variant="outline">Re-scrape</Button>
        <Button variant="ghost" onClick={() => { setExistingVideo(null); setInputValue(''); }}>Cancel</Button>
      </div>
    </div>
  )}
</div>
```

Glass card inline style (use this pattern consistently):
```typescript
const glassCard = {
  background: 'hsl(var(--re-bg-secondary-raw, 240 5% 8%) / 0.6)',
  backdropFilter: 'blur(12px)',
  border: '1px solid hsl(var(--re-border-raw, 240 3.7% 15.9%) / 0.6)',
  boxShadow: '0 4px 24px hsl(240 10% 2% / 0.4)',
  borderRadius: 'var(--re-border-radius)',
} as React.CSSProperties;
```

Actually, use Tailwind classes where possible and inline style only for backdrop-filter (which Tailwind v4 supports via `backdrop-blur-md`). Prefer: `className="bg-[--re-bg-secondary]/60 backdrop-blur-md border border-[--re-border]/60 rounded-[--re-border-radius] shadow-[0_4px_24px_hsl(240_10%_2%/0.4)]"`

Install missing icon imports from lucide-react: ArrowRight, Loader2, AlertCircle. Import Button from '@/components/ui/button'.

**src/components/scraper/ScrapePreviewCard.tsx** — 'use client'. Displays the metadata preview before confirming download.

Props:
```typescript
interface ScrapePreviewCardProps {
  preview: {
    youtubeId: string;
    title: string;
    thumbnailUrl: string;
    durationSeconds: number;
    channelName: string;
    viewCount: number;
  };
  onConfirm: () => void;
  onCancel: () => void;
  isLoading: boolean;
}
```

Helper `formatDuration(seconds: number): string`:
- < 60: "0:{s}" e.g. "0:45"
- < 3600: "M:SS" e.g. "5:30"
- >= 3600: "H:MM:SS" e.g. "1:23:45"

Helper `formatViewCount(count: number): string`:
- >= 1_000_000: `${(count/1_000_000).toFixed(1)}M views`
- >= 1_000: `${Math.round(count/1_000)}K views`
- else: `${count} views`

UI structure:
```jsx
<div className="...glass card flex gap-4 p-4...">
  <img src={preview.thumbnailUrl} alt={preview.title}
    className="w-48 h-27 object-cover rounded-[--re-border-radius-sm] flex-shrink-0" />
  <div className="flex-1 min-w-0">
    <h3 className="text-[--re-text-primary] font-medium text-base leading-snug line-clamp-2">{preview.title}</h3>
    <p className="text-[--re-text-muted] text-sm mt-1">{preview.channelName}</p>
    <div className="flex items-center gap-3 mt-2">
      <span className="...duration badge...">{formatDuration(preview.durationSeconds)}</span>
      <span className="text-[--re-text-muted] text-xs">{formatViewCount(preview.viewCount)}</span>
    </div>
    <div className="flex gap-3 mt-4">
      <Button onClick={onConfirm} disabled={isLoading} size="sm">
        {isLoading ? <Loader2 className="w-4 h-4 animate-spin mr-2" /> : <Download className="w-4 h-4 mr-2" />}
        Scrape Video
      </Button>
      <Button variant="ghost" size="sm" onClick={onCancel} disabled={isLoading}>Cancel</Button>
    </div>
  </div>
</div>
```

Duration badge styling: `text-xs px-2 py-0.5 rounded bg-[--re-bg-hover] text-[--re-text-secondary] font-mono`
  </action>
  <verify>
    <automated>cd /c/Antigravity/Sandbox && npx tsc --noEmit 2>&1 | head -20</automated>
  </verify>
  <done>
    TypeScript compiles cleanly. ScrapeInput handles single URL and multi-URL (batch) paste. Preview card shown after metadata fetch. Duplicate detection shows warning with re-scrape option. All colors via --re-* CSS variables. No hardcoded hex.
  </done>
</task>

<task type="auto">
  <name>Task 2: VideoCard, VideoGrid, Projects page, Project detail page</name>
  <files>
    src/components/scraper/VideoCard.tsx
    src/components/scraper/VideoGrid.tsx
    src/app/(dashboard)/projects/page.tsx
    src/app/(dashboard)/projects/[id]/page.tsx
  </files>
  <action>
**src/components/scraper/VideoCard.tsx** — 'use client'. Single video card in the grid.

Props:
```typescript
interface VideoCardProps {
  video: {
    id: string;
    youtube_id: string;
    original_title: string | null;
    original_thumbnail_url: string | null;
    channel_name: string | null;
    duration_seconds: number | null;
    scrape_status: 'pending' | 'processing' | 'complete' | 'error';
    view_count: number | null;
  };
  projectId: string;
}
```

Status badge config (local map):
```typescript
const STATUS_CONFIG = {
  pending: { label: 'Queued', color: 'text-[--re-text-muted]', bg: 'bg-[--re-bg-hover]' },
  processing: { label: 'Scraping', color: 'text-[--re-accent-primary]', bg: 'bg-[--re-accent-primary]/10' },
  complete: { label: 'Ready', color: 'text-[--re-success]', bg: 'bg-[--re-success]/10' },
  error: { label: 'Error', color: 'text-[--re-destructive]', bg: 'bg-[--re-destructive]/10' },
};
```

Card structure (Link to /dashboard/projects/{projectId}/videos/{video.id}):
```jsx
<Link href={`/dashboard/projects/${projectId}/videos/${video.id}`}>
  <div className="group flex flex-col overflow-hidden rounded-[--re-border-radius] bg-[--re-bg-secondary]/60 backdrop-blur-md border border-[--re-border]/60 hover:border-[--re-accent-primary]/40 transition-all duration-200 hover:shadow-[0_0_20px_hsl(217_91%_60%/0.12)]">
    {/* Thumbnail */}
    <div className="relative aspect-video bg-[--re-bg-hover] overflow-hidden">
      {video.original_thumbnail_url ? (
        <img src={video.original_thumbnail_url} alt={video.original_title || ''} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" />
      ) : (
        <div className="w-full h-full flex items-center justify-center">
          <Video className="w-8 h-8 text-[--re-text-disabled]" />
        </div>
      )}
      {/* Duration badge — bottom right of thumbnail */}
      {video.duration_seconds && (
        <span className="absolute bottom-2 right-2 text-xs px-1.5 py-0.5 rounded bg-black/70 text-white font-mono">
          {formatDuration(video.duration_seconds)}
        </span>
      )}
      {/* Status badge — top right of thumbnail */}
      <span className={`absolute top-2 right-2 text-xs px-2 py-0.5 rounded-full font-medium ${STATUS_CONFIG[video.scrape_status].color} ${STATUS_CONFIG[video.scrape_status].bg}`}>
        {STATUS_CONFIG[video.scrape_status].label}
      </span>
    </div>
    {/* Card body */}
    <div className="p-3 flex-1">
      <p className="text-[--re-text-primary] text-sm font-medium line-clamp-2 leading-snug">
        {video.original_title || 'Loading...'}
      </p>
      <p className="text-[--re-text-muted] text-xs mt-1 truncate">{video.channel_name || ''}</p>
    </div>
  </div>
</Link>
```

Note: bg-black/70 on duration badge is intentional — it's video overlay convention, not a design token violation. This is acceptable.

Import Video icon from lucide-react. Import Link from 'next/link'. Define formatDuration locally (same as ScrapePreviewCard — it's a tiny helper, acceptable duplication).

**src/components/scraper/VideoGrid.tsx** — 'use client'. Grid of VideoCards with loading skeleton.

Props:
```typescript
interface VideoGridProps {
  videos: VideoCardProps['video'][];
  projectId: string;
  isLoading?: boolean;
}
```

Responsive grid: `grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4`

Loading skeleton (shown when isLoading=true OR videos.length === 0 but isLoading):
```jsx
<div className="grid ...">
  {Array.from({ length: 8 }).map((_, i) => (
    <div key={i} className="rounded-[--re-border-radius] bg-[--re-bg-secondary] overflow-hidden animate-pulse">
      <div className="aspect-video bg-[--re-bg-hover]" />
      <div className="p-3 space-y-2">
        <div className="h-4 bg-[--re-bg-hover] rounded w-full" />
        <div className="h-3 bg-[--re-bg-hover] rounded w-2/3" />
      </div>
    </div>
  ))}
</div>
```

Empty state (when !isLoading && videos.length === 0):
```jsx
<div className="flex flex-col items-center justify-center py-16 text-center">
  <Video className="w-12 h-12 text-[--re-text-disabled] mb-4" />
  <p className="text-[--re-text-primary] font-medium">No videos yet</p>
  <p className="text-[--re-text-muted] text-sm mt-1">Paste a YouTube URL above to start scraping</p>
</div>
```

**src/app/(dashboard)/projects/page.tsx** — Server component. Fetch projects for the logged-in user.

Import createClient from '@/lib/supabase/server'. Import { redirect } from 'next/navigation'. Import Link from 'next/link'.

```typescript
export default async function ProjectsPage() {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) redirect('/login');

  const { data: projects } = await supabase
    .from('re_projects')
    .select('id, name, description, status, created_at')
    .order('created_at', { ascending: false });

  return (
    <div>
      <div className="flex items-center justify-between mb-6">
        <h1 className="text-[--re-text-xl] font-semibold text-[--re-text-primary]">Projects</h1>
        {/* Create project button — stub, wires in Phase 3/6 */}
        <Link href="/dashboard/projects/new">
          <Button size="sm"><Plus className="w-4 h-4 mr-2" /> New Project</Button>
        </Link>
      </div>
      {/* Project cards grid */}
      {projects?.length === 0 && (
        <div className="text-center py-16">
          <FolderOpen className="w-12 h-12 text-[--re-text-disabled] mx-auto mb-4" />
          <p className="text-[--re-text-primary] font-medium">No projects yet</p>
          <p className="text-[--re-text-muted] text-sm mt-1">Create your first project to start remixing videos</p>
        </div>
      )}
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        {projects?.map(project => (
          <Link key={project.id} href={`/dashboard/projects/${project.id}`}>
            <div className="p-4 rounded-[--re-border-radius] bg-[--re-bg-secondary]/60 backdrop-blur-md border border-[--re-border]/60 hover:border-[--re-accent-primary]/40 transition-all duration-200 cursor-pointer">
              <h3 className="text-[--re-text-primary] font-medium">{project.name}</h3>
              {project.description && <p className="text-[--re-text-muted] text-sm mt-1 line-clamp-2">{project.description}</p>}
              <p className="text-[--re-text-muted] text-xs mt-3">{new Date(project.created_at).toLocaleDateString()}</p>
            </div>
          </Link>
        ))}
      </div>
    </div>
  );
}
```

Import Plus, FolderOpen from lucide-react. Import Button from '@/components/ui/button'.

**src/app/(dashboard)/projects/[id]/page.tsx** — Server component. Project detail with ScrapeInput + VideoGrid.

```typescript
export default async function ProjectDetailPage({ params }: { params: Promise<{ id: string }> }) {
  const { id } = await params;
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) redirect('/login');

  // Fetch project
  const { data: project } = await supabase
    .from('re_projects')
    .select('id, name, description')
    .eq('id', id)
    .single();
  if (!project) notFound();

  // Fetch videos for this project
  const { data: videos } = await supabase
    .from('re_videos')
    .select('id, youtube_id, original_title, original_thumbnail_url, channel_name, duration_seconds, scrape_status, view_count')
    .eq('project_id', id)
    .order('created_at', { ascending: false });

  return (
    <div>
      <div className="mb-6">
        <h1 className="text-[--re-text-xl] font-semibold text-[--re-text-primary]">{project.name}</h1>
        {project.description && <p className="text-[--re-text-muted] text-sm mt-1">{project.description}</p>}
      </div>
      {/* Scrape input at top — locked UX decision */}
      <div className="mb-8">
        <ScrapeInput projectId={id} />
      </div>
      {/* Video library */}
      <VideoGrid videos={videos ?? []} projectId={id} />
    </div>
  );
}
```

Import notFound from 'next/navigation'. Import ScrapeInput from '@/components/scraper/ScrapeInput'. Import VideoGrid from '@/components/scraper/VideoGrid'.

Note: Next.js 15 App Router params is a Promise — must await params.
  </action>
  <verify>
    <automated>cd /c/Antigravity/Sandbox && npx tsc --noEmit 2>&1 | head -30</automated>
  </verify>
  <done>
    TypeScript compiles cleanly. VideoCard renders thumbnail, duration badge, status badge, channel name. VideoGrid shows skeleton when loading, empty state when no videos. Projects page lists all projects. Project detail [id] page shows ScrapeInput + VideoGrid. All CSS values use --re-* variables. Glassmorphism applied via backdrop-blur-md + bg/border opacity.
  </done>
</task>

</tasks>

<verification>
Run: npx tsc --noEmit — must pass with zero errors.
Check: grep -r "#[0-9a-fA-F]\{6\}" src/components/scraper/ — must return empty (no hex colors except intentional video overlay bg-black/70).
Check: src/components/scraper/ScrapeInput.tsx contains "scrape/preview" fetch call.
Check: src/app/(dashboard)/projects/[id]/page.tsx imports ScrapeInput and VideoGrid.
Check: VideoCard STATUS_CONFIG has entries for 'pending', 'processing', 'complete', 'error'.
</verification>

<success_criteria>
- ScrapeInput auto-detects single vs multi-URL input
- Preview card appears after metadata fetch, before any download
- Duplicate detection shows warning with re-scrape option
- VideoCard shows thumbnail, duration badge (on image), status badge (on image), title, channel name
- VideoGrid has responsive 1→2→3→4 column grid
- Empty state renders in VideoGrid when videos.length === 0
- Loading skeleton renders when isLoading=true
- Project detail page passes projectId to both ScrapeInput and VideoGrid
</success_criteria>

<output>
After completion, create `.planning/phases/02-scraping-pipeline-4-hours/02-04-SUMMARY.md` following the summary template.
</output>
